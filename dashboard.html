<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <title>Neuralux ai â€” AI Chat</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <!-- Prism.js VS Code Dark+ theme -->
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-vsc-dark-plus.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-markup.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-typescript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-jsx.min.js"></script>

    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
         <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2001975635093204"
        crossorigin="anonymous"></script>
    <style>
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #111827;
            --bg-tertiary: #1f2937;
            --text-primary: #f9fafb;
            --text-secondary: #d1d5db;
            --text-muted: #9ca3af;
            --accent-primary: #8b5cf6;
            --accent-secondary: #a78bfa;
            --border-primary: rgba(255, 255, 255, 0.1);
            --border-secondary: rgba(255, 255, 255, 0.05);
        }

        * {
            box-sizing: border-box;
        }

        html,
        body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0a0a0f 0%, #111827 50%, #1f2937 100%);
            color: var(--text-primary);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .custom-scrollbar {
            scrollbar-width: thin;
            scrollbar-color: rgba(139, 92, 246, 0.3) transparent;
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(139, 92, 246, 0.3);
            border-radius: 2px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: rgba(139, 92, 246, 0.5);
        }

        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .glass-strong {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(24px);
            border: 1px solid rgba(255, 255, 255, 0.15);
        }

        .message-user {
            background: rgba(31, 41, 55, 0.8);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .message-assistant {
            background: none;
        }

        .fade-in {
            animation: fadeIn 0.3s ease-out forwards;
            opacity: 0;
            transform: translateY(8px);
        }

        @keyframes fadeIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .slide-in {
            animation: slideIn 0.25s ease-out forwards;
        }

        @keyframes slideIn {
            from {
                transform: translateX(-100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            background: rgba(31, 41, 55, 0.8);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            max-width: fit-content;
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--accent-primary);
            animation: typingPulse 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typingPulse {

            0%,
            60%,
            100% {
                opacity: 0.3;
                transform: scale(0.8);
            }

            30% {
                opacity: 1;
                transform: scale(1);
            }
        }

        .sidebar {
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .sidebar-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
            z-index: 40;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .sidebar-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .btn-primary {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            transition: all 0.2s ease;
            min-height: 44px;
            min-width: 44px;
        }

        .btn-primary:hover:not(:disabled) {
            background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(139, 92, 246, 0.3);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.2s ease;
            min-height: 44px;
            min-width: 44px;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(139, 92, 246, 0.3);
            transform: translateY(-1px);
        }

        .input-focus {
            transition: all 0.2s ease;
        }

        .input-focus:focus {
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
            outline: none;
        }

        .chat-item {
            transition: all 0.2s ease;
            border-radius: 12px;
            min-height: 60px;
        }

        .chat-item:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateX(2px);
        }

        .chat-item.active {
            background: rgba(139, 92, 246, 0.15);
            border: 1px solid rgba(139, 92, 246, 0.3);
        }

        .composer {
            transition: all 0.2s ease;
        }

        .composer:focus-within {
            box-shadow: 0 6px 24px rgba(139, 92, 246, 0.2);
            transform: translateY(-1px);
        }

        .loading-pulse {
            animation: loadingPulse 2s infinite ease-in-out;
        }

        @keyframes loadingPulse {

            0%,
            100% {
                opacity: 0.4;
            }

            50% {
                opacity: 1;
            }
        }

        .messages-container {
            scroll-behavior: smooth;
        }

        .welcome-gradient {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.1) 0%, rgba(124, 58, 237, 0.05) 100%);
            border: 1px solid rgba(139, 92, 246, 0.2);
        }

        /* Ultra-responsive design for all screen sizes */
        @media (max-width: 320px) {
            .sidebar {
                width: 100vw;
                max-width: 100vw;
            }

            .mobile-header {
                padding: 6px 8px !important;
                min-height: 50px;
            }

            .mobile-header .chat-info h2 {
                font-size: 12px !important;
            }

            .mobile-header .header-actions {
                gap: 2px;
            }

            .mobile-header .header-actions button {
                width: 32px;
                height: 32px;
                padding: 4px;
            }

            .composer {
                padding: 8px !important;
                margin: 6px !important;
            }

            .composer textarea {
                font-size: 14px;
                padding: 8px;
            }

            .sidebar-header {
                padding: 12px 8px !important;
            }

            .sidebar-header h1 {
                font-size: 14px !important;
            }

            .sidebar-header p {
                font-size: 10px !important;
            }

            .chat-item {
                padding: 8px !important;
                min-height: 50px;
            }

            .message-bubble {
                max-width: 98% !important;
                font-size: 13px;
            }

            .btn-primary,
            .btn-secondary {
                min-height: 36px;
                min-width: 36px;
                padding: 6px 8px;
            }
        }

        @media (min-width: 321px) and (max-width: 374px) {
            .sidebar {
                width: 100vw;
                max-width: 100vw;
            }

            .mobile-header {
                padding: 8px 12px !important;
                min-height: 56px;
            }

            .mobile-header .chat-info {
                min-width: 0;
                flex: 1;
            }

            .mobile-header .chat-info h2 {
                font-size: 13px !important;
            }

            .mobile-header .header-actions {
                gap: 4px;
            }

            .mobile-header .header-actions button {
                width: 36px;
                height: 36px;
                padding: 6px;
            }

            .composer {
                padding: 12px !important;
                margin: 8px !important;
            }

            .composer textarea {
                font-size: 16px;
            }

            .sidebar-header {
                padding: 16px 12px !important;
            }

            .sidebar-header h1 {
                font-size: 16px !important;
            }

            .sidebar-header p {
                font-size: 12px !important;
            }

            .chat-item {
                padding: 12px !important;
                min-height: 56px;
            }

            .message-bubble {
                max-width: 95% !important;
                font-size: 14px;
            }
        }

        @media (min-width: 375px) and (max-width: 413px) {
            .sidebar {
                width: 90vw;
                max-width: 320px;
            }

            .mobile-header {
                padding: 12px 16px !important;
            }

            .composer {
                padding: 16px !important;
                margin: 12px !important;
            }
        }

        @media (min-width: 414px) and (max-width: 767px) {
            .sidebar {
                width: 85vw;
                max-width: 350px;
            }
        }

        @media (min-width: 768px) and (max-width: 1023px) {
            .sidebar {
                width: 380px;
                max-width: 45vw;
            }

            .main-content {
                margin-top: 0 !important;
            }

            .mobile-navbar {
                position: relative !important;
            }
        }

        @media (max-width: 1023px) {
            .sidebar {
                position: fixed;
                top: 0;
                left: 0;
                bottom: 0;
                width: 85vw;
                max-width: 350px;
                z-index: 50;
                transform: translateX(-100%);
                height: 100vh;
                display: flex;
                flex-direction: column;
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .sidebar #chats-list {
                flex: 1;
                overflow-y: auto;
                min-height: 0;
                max-height: none;
            }

            .main-content {
                margin-left: 0;
                margin-top: 65px;
            }

            .mobile-navbar {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                z-index: 45;
                backdrop-filter: blur(20px);
                background: rgba(10, 10, 15, 0.95);
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            }
        }

        @media (min-width: 1024px) {
            .sidebar {
                position: relative;
                transform: translateX(0);
                width: 320px;
                display: flex !important;
                height: 100vh;
            }

            .main-content {
                margin-left: 0;
                margin-top: 0 !important;
            }

            .mobile-only {
                display: none !important;
            }

            .mobile-navbar {
                position: relative !important;
                backdrop-filter: none !important;
                background: transparent !important;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1) !important;
            }
        }

        @media (min-width: 1440px) {
            .sidebar {
                width: 380px;
            }
        }

        @media (min-width: 1920px) {
            .sidebar {
                width: 420px;
            }
        }

        /* Landscape orientation optimizations */
        @media (max-height: 500px) and (orientation: landscape) {
            .sidebar-header {
                padding: 8px 12px !important;
            }

            .sidebar-header .logo-section {
                gap: 6px !important;
            }

            .sidebar-header .logo {
                width: 32px !important;
                height: 32px !important;
            }

            .sidebar-header h1 {
                font-size: 14px !important;
            }

            .sidebar-header p {
                display: none;
            }

            .mobile-header {
                min-height: 44px !important;
                padding: 6px 12px !important;
            }

            .composer {
                padding: 8px !important;
                margin: 8px !important;
            }

            .chat-item {
                min-height: 48px !important;
                padding: 8px 12px !important;
            }
        }

        /* Touch device optimizations */
        @media (hover: none) and (pointer: coarse) {
            .btn-primary:active {
                transform: scale(0.98);
                background: linear-gradient(135deg, #6d28d9 0%, #5b21b6 100%);
            }

            .btn-secondary:active {
                transform: scale(0.98);
                background: rgba(255, 255, 255, 0.15);
            }

            .chat-item:active {
                transform: scale(0.98);
                background: rgba(255, 255, 255, 0.12);
            }
        }

        /* Safe area support for notched devices */
        @supports (padding: max(0px)) {
            .mobile-header {
                padding-top: max(12px, env(safe-area-inset-top));
            }

            .composer {
                padding-bottom: max(16px, env(safe-area-inset-bottom));
            }

            .sidebar {
                padding-top: max(0px, env(safe-area-inset-top));
            }
        }

        /* High DPI display optimizations */
        @media (-webkit-min-device-pixel-ratio: 2),
        (min-resolution: 192dpi) {
            .glass {
                backdrop-filter: blur(16px);
            }

            .glass-strong {
                backdrop-filter: blur(20px);
            }
        }

        /* Accessibility - reduced motion */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Dark mode enhancements */
        @media (prefers-color-scheme: dark) {
            :root {
                --bg-primary: #000000;
                --bg-secondary: #0a0a0a;
                --bg-tertiary: #111111;
            }
        }

        .focus-visible {
            outline: 2px solid var(--accent-primary);
            outline-offset: 2px;
        }

        /* Message responsive styles */
        @media (max-width: 480px) {
            .message-container {
                padding: 8px 12px;
            }

            .message-bubble {
                max-width: 95%;
                padding: 10px 14px;
                border-radius: 16px;
            }

            .message-user .message-bubble {
                border-bottom-right-radius: 4px;
            }

            .message-assistant .message-bubble {
                border-bottom-left-radius: 4px;
            }
        }

        @media (min-width: 481px) and (max-width: 767px) {
            .message-container {
                padding: 12px 16px;
            }

            .message-bubble {
                max-width: 90%;
                padding: 12px 16px;
                border-radius: 18px;
            }

            .message-user .message-bubble {
                border-bottom-right-radius: 6px;
            }

            .message-assistant .message-bubble {
                border-bottom-left-radius: 6px;
            }
        }

        @media (min-width: 768px) {
            .message-container {
                padding: 16px 24px;
            }

            .message-bubble {
                max-width: 85%;
                padding: 16px 20px;
                border-radius: 20px;
            }
        }

        /* Typography responsive scaling */
        .message-content h1 {
            font-size: clamp(18px, 4vw, 24px);
            font-weight: 700;
            color: white;
            margin: 1rem 0 0.75rem 0;
        }

        .message-content h2 {
            font-size: clamp(16px, 3.5vw, 20px);
            font-weight: 600;
            color: white;
            margin: 0.875rem 0 0.5rem 0;
        }

        .message-content h3 {
            font-size: clamp(14px, 3vw, 18px);
            font-weight: 600;
            color: white;
            margin: 0.75rem 0 0.5rem 0;
        }

        .message-content ul,
        .message-content ol {
            margin: 0.75rem 0;
            padding-left: clamp(1rem, 4vw, 1.5rem);
        }

        .message-content li {
            margin: 0.25rem 0;
        }

        /* Code block responsive styling */
        .message-content pre {
            background: #1e1e1e !important;
            color: #d4d4d4 !important;
            border: 1px solid #2d2d30;
            border-radius: 6px;
            padding: clamp(12px, 3vw, 16px);
            margin: 12px 0;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: "Consolas", "Courier New", "Menlo", monospace;
            font-size: clamp(12px, 2.5vw, 14px);
            line-height: 1.5;
            position: relative;
            max-width: 100%;
        }

        .message-content pre code {
            background: transparent !important;
            padding: 0 !important;
            color: #d4d4d4 !important;
            font-family: "Consolas", "Courier New", "Menlo", monospace;
            font-size: inherit;
            line-height: 1.5;
            border-radius: 0;
        }

        /* Inline code - VS Code style */
        .message-content code:not(pre code) {
            background: #2d2d30 !important;
            color: #ce9178 !important;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: "Consolas", "Courier New", "Menlo", monospace;
            font-size: clamp(11px, 2.2vw, 13px);
            font-weight: normal;
        }

        /* VS Code Dark+ Syntax Highlighting - Exact Colors */
        .token.comment,
        .token.prolog,
        .token.doctype,
        .token.cdata {
            color: #6a9955 !important;
            font-style: italic;
        }

        .token.punctuation {
            color: #d4d4d4 !important;
        }

        .token.property,
        .token.tag,
        .token.constant,
        .token.symbol,
        .token.deleted {
            color: #569cd6 !important;
        }

        .token.boolean,
        .token.number {
            color: #b5cea8 !important;
        }

        .token.selector,
        .token.attr-name,
        .token.string,
        .token.char,
        .token.builtin,
        .token.inserted {
            color: #ce9178 !important;
        }

        .token.operator,
        .token.entity,
        .token.url {
            color: #d4d4d4 !important;
        }

        .token.keyword {
            color: #569cd6 !important;
            font-weight: normal;
        }

        .token.function {
            color: #dcdcaa !important;
        }

        .token.variable {
            color: #9cdcfe !important;
        }

        .token.class-name {
            color: #4ec9b0 !important;
        }

        .token.regex,
        .token.important {
            color: #d16969 !important;
        }

        .token.atrule {
            color: #c586c0 !important;
        }

        .token.attr-value {
            color: #ce9178 !important;
        }

        .token.namespace {
            opacity: 0.7;
        }

        /* JavaScript specific */
        .language-javascript .token.keyword,
        .language-js .token.keyword {
            color: #569cd6 !important;
        }

        .language-javascript .token.function,
        .language-js .token.function {
            color: #dcdcaa !important;
        }

        /* TypeScript specific */
        .language-typescript .token.keyword,
        .language-ts .token.keyword {
            color: #569cd6 !important;
        }

        .language-typescript .token.builtin,
        .language-ts .token.builtin {
            color: #4ec9b0 !important;
        }

        /* CSS specific */
        .language-css .token.selector {
            color: #d7ba7d !important;
        }

        .language-css .token.property {
            color: #9cdcfe !important;
        }

        /* HTML specific */
        .language-html .token.tag .token.tag {
            color: #569cd6 !important;
        }

        .language-html .token.tag .token.punctuation {
            color: #808080 !important;
        }

        .language-html .token.attr-name {
            color: #9cdcfe !important;
        }

        .copy-button {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: #d4d4d4;
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 6px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            opacity: 0.7;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .copy-button:hover {
            background: rgba(255, 255, 255, 0.2);
            opacity: 1;
            border-color: rgba(255, 255, 255, 0.2);
        }

        .copy-button i {
            color: #d4d4d4;
        }

        .copy-button:hover i {
            color: #ffffff;
        }

        .message-content strong {
            font-weight: 600;
            color: white;
        }

        .message-content em {
            font-style: italic;
        }

        /* Force 16px font size on mobile to prevent zoom */
        @media (max-width: 767px) {
            .composer textarea {
                font-size: 16px !important;
            }
        }


        .loading-shimmer {
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            animation: shimmer 1.5s infinite;
        }

        @keyframes shimmer {
            0% {
                transform: translateX(-100%);
            }

            100% {
                transform: translateX(100%);
            }
        }

        /* Utility classes for responsive hiding/showing */
        @media (max-width: 640px) {
            .sm-hidden {
                display: none !important;
            }
        }

        @media (min-width: 641px) {
            .sm-block {
                display: block !important;
            }
        }

        @media (max-width: 1023px) {
            .lg-hidden {
                display: none !important;
            }
        }

        @media (min-width: 1024px) {
            .lg-block {
                display: block !important;
            }

            .lg-flex {
                display: flex !important;
            }
        }

        /* Enhanced responsive code blocks */
        @media (max-width: 480px) {
            .message-content pre {
                padding-right: 2.5rem;
                font-size: 11px;
                line-height: 1.4;
            }

            .copy-button {
                font-size: 10px;
                padding: 4px 6px;
                top: 6px;
                right: 6px;
            }
        }

        /* Image container responsive styling */
        .image-container {
            max-width: 100%;
            margin: 12px 0;
        }

        .image-container img {
            width: 100%;
            height: auto;
            max-height: min(400px, 50vh);
            object-fit: contain;
            border-radius: 8px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        @media (max-width: 480px) {
            .image-container img {
                max-height: min(300px, 40vh);
                border-radius: 6px;
            }
        }

        /* Loading states for image generation */
        .image-loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
            background: rgba(139, 92, 246, 0.1);
            border: 1px dashed rgba(139, 92, 246, 0.3);
            border-radius: 8px;
            margin: 12px 0;
        }

        .image-loading-spinner {
            width: 24px;
            height: 24px;
            border: 2px solid rgba(139, 92, 246, 0.3);
            border-top: 2px solid var(--accent-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Enhanced button spacing and sizing */
        .composer .flex {
            align-items: flex-end;
            gap: clamp(8px, 2vw, 16px);
        }

        .composer button {
            min-width: clamp(40px, 8vw, 48px);
            min-height: clamp(40px, 8vw, 48px);
            border-radius: clamp(8px, 2vw, 12px);
        }

        /* Ultra-small screen optimizations */
        @media (max-width: 280px) {
            .sidebar {
                width: 100vw !important;
                max-width: 100vw !important;
            }

            .mobile-header {
                padding: 4px 6px !important;
                min-height: 44px !important;
            }

            .mobile-header .header-actions button {
                width: 28px !important;
                height: 28px !important;
                padding: 2px !important;
            }

            .mobile-header .header-actions svg {
                width: 14px !important;
                height: 14px !important;
            }

            .composer {
                padding: 6px !important;
                margin: 4px !important;
            }

            .composer button {
                min-width: 32px !important;
                min-height: 32px !important;
                padding: 4px !important;
            }

            .composer svg {
                width: 16px !important;
                height: 16px !important;
            }

            .sidebar-header .logo {
                width: 28px !important;
                height: 28px !important;
            }

            .sidebar-header h1 {
                font-size: 12px !important;
            }

            .message-bubble {
                font-size: 12px !important;
                padding: 8px 10px !important;
            }
        }

        /* Improved sidebar scrolling behavior */
        .sidebar #chats-list {
            -webkit-overflow-scrolling: touch;
            overscroll-behavior: contain;
        }

        /* Better message spacing on different screen sizes */
        @media (max-width: 374px) {
            #messages {
                padding: 12px 8px !important;
                gap: 8px !important;
            }
        }

        @media (min-width: 375px) and (max-width: 767px) {
            #messages {
                padding: 16px 12px !important;
                gap: 12px !important;
            }
        }

        @media (min-width: 768px) {
            #messages {
                padding: 24px !important;
                gap: 16px !important;
            }
        }
    </style>
</head>

<body>
    <div id="sidebar-overlay" class="sidebar-overlay"></div>

    <div class="h-screen flex">
        <aside id="sidebar" class="sidebar hidden lg:flex flex-col glass-strong">
            <div class="sidebar-header p-4 lg:p-6 border-b border-white/10 shrink-0">
                <div class="flex items-center justify-between mb-4 lg:mb-6">
                    <div class="logo-section flex items-center gap-2 lg:gap-3 min-w-0 flex-1">
                        <div
                            class="logo w-10 h-10 lg:w-12 lg:h-12 rounded-xl bg-gradient-to-br from-violet-500 to-purple-600 flex items-center justify-center shadow-lg shrink-0">
                            <img width="48" height="48"
                                src="https://img.icons8.com/pulsar-gradient/48/artificial-intelligence.png"
                                alt="artificial-intelligence" />
                        </div>
                        <div class="min-w-0 flex-1">
                            <h1 class="text-white font-bold text-base lg:text-lg truncate">Neuralux ai</h1>
                            <p class="text-xs lg:text-sm text-gray-400 truncate">AI Assistant</p>
                        </div>
                    </div>

                    <button id="sidebar-close" class="mobile-only lg:hidden p-2 rounded-lg btn-secondary shrink-0">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>

                <button id="new-chat-btn"
                    class="w-full btn-primary text-white py-3 px-4 rounded-xl font-medium text-sm lg:text-base">
                    <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                    </svg>
                    New Chat
                </button>
            </div>

            <div class="p-3 lg:p-4 shrink-0">
                <div class="relative">
                    <input id="chat-search" type="text" placeholder="Search conversations..."
                        class="w-full bg-white/5 border border-white/10 rounded-lg px-3 lg:px-4 py-2 lg:py-3 pl-10 text-sm input-focus placeholder-gray-400 text-white" />
                    <svg class="w-4 h-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400" fill="none"
                        stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                </div>
            </div>

            <div id="chats-list" class="flex-1 overflow-y-auto custom-scrollbar px-3 lg:px-4 pb-4 min-h-0"></div>

            <div class="p-3 lg:p-4 border-t border-white/10 shrink-0 min-h-20px max-h-50px">
                <div class="flex items-center gap-2 lg:gap-3">
                    <div id="userAvatar"
                        class="w-8 h-8 lg:w-10 lg:h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold text-xs lg:text-sm shrink-0">
                        U
                    </div>

                    <div class="flex-1 min-w-0">
                        <p id="userName" class="text-xs lg:text-sm font-medium text-white truncate">You</p>
                        <p id="userEmail" class="text-xs text-gray-400 truncate hidden lg:block">smartdiamond@ai.chat
                        </p>
                    </div>

                    <div class="flex items-center gap-2">
                        <div class="text-xs text-gray-500 mr-2">v2.0</div>
                        <button id="signout-btn" onclick="logOut()" type="button" title="Sign out"
                            class="p-2 rounded-lg btn-secondary text-sm hidden lg:inline-flex items-center">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a2 2 0 01-2 2H6a2 2 0 01-2-2V7a2 2 0 012-2h5a2 2 0 012 2v1" />
                            </svg>
                            Sign out
                        </button>
                    </div>
                </div>
            </div>

        </aside>

        <main class="flex-1 main-content flex flex-col bg-gradient-to-br from-gray-900/50 to-gray-800/30">
            <header class="mobile-navbar mobile-header glass border-b border-white/10 px-3 lg:px-6 py-3 lg:py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-2 lg:gap-4 flex-1 min-w-0">
                        <button id="sidebar-toggle" class="mobile-only lg:hidden p-2 rounded-lg btn-secondary shrink-0">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M4 6h16M4 12h16M4 18h16" />
                            </svg>
                        </button>

                        <div class="chat-info flex items-center gap-2 lg:gap-3 flex-1 min-w-0">
                            <div
                                class="w-8 h-8 lg:w-10 lg:h-10 rounded-lg bg-gradient-to-br from-violet-500 to-purple-600 flex items-center justify-center shadow-lg shrink-0">
                                <img width="48" height="48"
                                    src="https://img.icons8.com/pulsar-gradient/48/artificial-intelligence.png"
                                    alt="artificial-intelligence" />
                            </div>
                            <div class="min-w-0 flex-1">
                                <h2 id="chat-title" class="text-sm lg:text-lg font-semibold text-white truncate">New
                                    Conversation</h2>
                                <p id="chat-subtitle" class="text-xs lg:text-sm text-gray-400 truncate">
                                    Start chatting with Neuralux ai</p>
                            </div>
                        </div>
                    </div>

                    <div class="header-actions flex items-center gap-1 lg:gap-2 shrink-0">
                        <button id="rename-chat-btn" title="Rename chat" class="p-2 lg:p-2 rounded-lg btn-secondary">
                            <svg class="w-4 h-4 lg:w-5 lg:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                            </svg>
                        </button>
                        <button id="export-chat-btn" title="Export chat"
                            class="p-2 lg:p-2 rounded-lg btn-secondary sm-hidden lg:block">
                            <svg class="w-4 h-4 lg:w-5 lg:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                        </button>
                        <button id="delete-chat-btn" title="Delete chat"
                            class="p-2 lg:p-2 rounded-lg btn-secondary hover:bg-red-500/20 hover:border-red-500/30">
                            <svg class="w-4 h-4 lg:w-5 lg:h-5 text-red-400" fill="none" stroke="currentColor"
                                viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                            </svg>
                        </button>
                    </div>
                </div>
            </header>

            <div class="flex-1 flex flex-col overflow-hidden">
                <div id="messages-container" class="flex-1 overflow-y-auto custom-scrollbar messages-container">
                    <div id="empty-state" class="h-full flex items-center justify-center p-4 lg:p-8">
                        <div class="text-center max-w-xs sm:max-w-sm lg:max-w-md mx-auto px-4">
                            <div
                                class="w-16 h-16 lg:w-20 lg:h-20 rounded-2xl bg-gradient-to-br from-violet-500 to-purple-600 flex items-center justify-center mx-auto mb-4 lg:mb-6 shadow-2xl">
                                <img width="48" height="48"
                                    src="https://img.icons8.com/pulsar-gradient/48/artificial-intelligence.png"
                                    alt="artificial-intelligence" />
                            </div>
                            <h3 class="text-lg sm:text-xl lg:text-2xl font-bold text-white mb-2 lg:mb-3">Welcome to
                                Neuralux ai
                            </h3>
                            <p class="text-xs sm:text-sm lg:text-base text-gray-400 mb-6 lg:mb-8 leading-relaxed">Your
                                intelligent AI assistant is ready to help. Ask questions, get insights, or explore ideas
                                with beautifully formatted responses.</p>
                                <!-- Google AdSense Ad Block -->
                            <div class="my-6 text-center">
                                <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-2001975635093204"
                                    data-ad-slot="4898195384" data-ad-format="auto"
                                    data-full-width-responsive="true"></ins>
                                <script>
                                    (adsbygoogle = window.adsbygoogle || []).push({});
                                </script>
                            </div>
                        </div>
                    </div>

                    <div id="messages" class="space-y-4 lg:space-y-6 p-3 lg:p-6 min-h-full"></div>
                </div>

                <div class="border-t border-white/10 p-3 lg:p-6 shrink-0">
                    <div class="composer glass-strong rounded-xl lg:rounded-2xl p-3 lg:p-4">
                        <div class="flex items-end gap-2 lg:gap-4">
                            <div class="flex-1 min-w-0">
                                <textarea id="composer-input" rows="1" placeholder="Ask Neuralux ai anything..."
                                    class="w-full bg-transparent resize-none outline-none text-white placeholder-gray-400 leading-relaxed text-sm lg:text-base"
                                    style="max-height: 100px; min-height: 20px;"></textarea>
                            </div>
                            <button id="image-gen-btn" title="Generate Image"
                                class="btn-secondary text-white p-2 lg:p-3 rounded-lg lg:rounded-xl shrink-0">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 2h12a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V4a2 2 0 012-2z" />
                                </svg>
                            </button>
                            <button id="send-btn"
                                class="btn-primary text-white p-2 lg:p-3 rounded-lg lg:rounded-xl shrink-0">
                                â†‘
                            </button>
                        </div>

                        <div class="flex items-center justify-between mt-2 lg:mt-3 text-xs text-gray-400">
                            <span class="sm-hidden lg:block">Press Enter to send </span>
                            <span class="lg-hidden">Tap to send</span>
                            <div id="typing-status" class="hidden flex items-center gap-2">
                                <span class="text-violet-400 text-xs">thinking</span>
                                <div class="flex gap-1">
                                    <div class="typing-dot"></div>
                                    <div class="typing-dot"></div>
                                    <div class="typing-dot"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>


    <script>


        const STORAGE_KEY = 'smartdiamond_chats_v2';
        const META_KEY = 'smartdiamond_meta_v2';
        const SYSTEM_PROMPT = `
You are **Neuralux ai**, a highly intelligent, elegant, and professional AI assistant created by Olowolagba Diamond Ayodeji.  
Your purpose is to provide helpful, accurate, and beautifully structured responses to any question the user asks.

### Image Generation Capability:
- You can generate images when users request them
- The system will automatically detect image generation requests and create the image
- You have access to advanced AI image generation through Hugging Face models

### Core Behavior:
- Always maintain a **professional yet friendly tone**.
- Answer with **clarity, structure, and depth**, avoiding vague replies.
- Use **proper Markdown formatting** for headers, lists, code blocks, and emphasis.
- Provide **actionable insights** and **practical examples** when relevant.
- Be **concise but comprehensive** - cover the topic thoroughly without unnecessary verbosity.

### Response Structure:
- Use **headers** (# ## ###) to organize information hierarchically
- Apply **bold** for key concepts and important points
- Use *italics* for emphasis and technical terms
- Create **bullet points** and **numbered lists** for clarity
- Include \`inline code\` for commands, variables, and technical terms
- Use **code blocks** with proper language syntax highlighting
- Add **tables** for comparing data or options
- Include **emojis** strategically for visual appeal (ðŸš€ âš¡ ðŸ’¡ ðŸŽ¯ âœ¨ ðŸ”§ ðŸ“Š ðŸŽ¨)

### Expertise Areas:
- **Technology & Programming** - All languages, frameworks, best practices
- **Business & Strategy** - Analysis, planning, optimization
- **Science & Research** - Data analysis, methodology, insights
- **Creative Projects** - Writing, design, content creation
- **Problem Solving** - Debugging, troubleshooting, solutions
- **Education** - Explanations, tutorials, learning paths

### Key Guidelines:
1. **Always be helpful** - Go above and beyond to assist users
2. **Stay accurate** - Provide correct, up-to-date information
3. **Be structured** - Organize responses logically and clearly
4. **Think critically** - Analyze problems from multiple angles
5. **Encourage learning** - Explain concepts and provide context
6. **Admit limitations** - Be honest when uncertain about something

### Special Instructions:
- If asked **"Who created you?"** â†’ Always reply: **"I was created by Olowolagba Diamond Ayodeji."**
- For code examples, always use proper syntax highlighting and include comments
- When discussing complex topics, break them down into digestible sections
- Provide follow-up questions or suggestions to continue the conversation
- Use professional language while remaining approachable and engaging

**Your mission**: Be the most helpful, knowledgeable, and well-structured AI assistant possible. Every response should add genuine value and demonstrate expertise while maintaining clarity and professionalism.
`;

        const API_KEY = "AIzaSyBc5sRt_p6rS1Z5F5Gtr-Ln29m-jbwTiMg";
        const HF_API_KEY = "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";


        document.addEventListener('DOMContentLoaded', () => {
            // Add copy buttons to existing code blocks
            setTimeout(() => {
                document.querySelectorAll('.message-content pre').forEach(block => {
                    if (!block.querySelector('.copy-button')) {
                        const button = document.createElement('button');
                        button.className = 'copy-button';
                        button.innerHTML = '<i class="fa-solid fa-copy"></i>';
                        block.appendChild(button);

                        button.addEventListener('click', () => {
                            const code = block.querySelector('code').innerText;
                            navigator.clipboard.writeText(code).then(() => {
                                button.innerHTML = '<i class="fa-solid fa-check"></i>';
                                setTimeout(() => button.innerHTML = '<i class="fa-solid fa-copy"></i>', 2000);
                            });
                        });
                    }
                });

                // Apply syntax highlighting
                if (window.Prism) {
                    Prism.highlightAll();
                }
            }, 100);
        });

        const elements = {
            sidebar: document.getElementById('sidebar'),
            sidebarOverlay: document.getElementById('sidebar-overlay'),
            sidebarToggle: document.getElementById('sidebar-toggle'),
            sidebarClose: document.getElementById('sidebar-close'),
            chatsList: document.getElementById('chats-list'),
            messagesContainer: document.getElementById('messages-container'),
            messages: document.getElementById('messages'),
            emptyState: document.getElementById('empty-state'),
            chatTitle: document.getElementById('chat-title'),
            chatSubtitle: document.getElementById('chat-subtitle'),
            composerInput: document.getElementById('composer-input'),
            sendBtn: document.getElementById('send-btn'),
            typingStatus: document.getElementById('typing-status'),
            newChatBtn: document.getElementById('new-chat-btn'),
            chatSearch: document.getElementById('chat-search'),
            renameBtn: document.getElementById('rename-chat-btn'),
            deleteBtn: document.getElementById('delete-chat-btn'),
            exportBtn: document.getElementById('export-chat-btn'),
            quickExampleBtn: document.getElementById('quick-example-btn'),
            imageGenBtn: document.getElementById('image-gen-btn'),
            logoOut: document.getElementById('signout-btn')
        };

        let chats = [];
        let selectedChatId = null;
        let isLoading = false;

        function uid(prefix = 'id') {
            return prefix + '_' + Math.random().toString(36).slice(2, 11);
        }

        function nowISO() {
            return new Date().toISOString();
        }

        function formatTime(iso) {
            const date = new Date(iso);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);

            if (diffMins < 1) return 'Just now';
            if (diffMins < 60) return `${diffMins}m ago`;
            if (diffHours < 24) return `${diffHours}h ago`;
            if (diffDays < 7) return `${diffDays}d ago`;

            return date.toLocaleDateString();
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML.replace(/\n/g, '<br>');
        }

        function truncateText(text, maxLength = 60) {
            if (!text) return '';
            return text.length > maxLength ? text.slice(0, maxLength) + '...' : text;
        }

        function scrollToBottom(retries = 0) {
            const maxRetries = 3;
            const delays = [0, 100, 300];

            setTimeout(() => {
                if (elements.messagesContainer) {
                    const { scrollTop, scrollHeight, clientHeight } = elements.messagesContainer;
                    const isAtBottom = Math.abs(scrollHeight - clientHeight - scrollTop) < 20;

                    elements.messagesContainer.scrollTop = scrollHeight;

                    if (!isAtBottom && retries < maxRetries) {
                        scrollToBottom(retries + 1);
                    }
                }
            }, delays[retries] || 300);
        }

        function saveState() {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(chats));
                localStorage.setItem(META_KEY, JSON.stringify({ selectedChatId }));
            } catch (error) {
                console.error('Error saving state:', error);
            }
        }

        function loadState() {
            try {
                const chatsData = localStorage.getItem(STORAGE_KEY);
                const metaData = localStorage.getItem(META_KEY);

                chats = chatsData ? JSON.parse(chatsData) : [];
                const meta = metaData ? JSON.parse(metaData) : {};
                selectedChatId = meta.selectedChatId || (chats[0]?.id) || null;
            } catch (error) {
                console.error('Error loading state:', error);
                chats = [];
                selectedChatId = null;
            }
        }

        function getSelectedChat() {
            return chats.find(chat => chat.id === selectedChatId) || null;
        }

        function logOut() {
            logOut();
        }
      async function logOutCompleteKeepChats() {
  try {
    // server-side sign out (invalidate session)
    if (window.supabase && supabase.auth && typeof supabase.auth.signOut === 'function') {
      const { error } = await supabase.auth.signOut();
      if (error) console.warn('supabase.signOut error:', error.message || error);
    }

    // Remove only auth-related keys (do NOT clear STORAGE_KEY)
    try {
      localStorage.removeItem('supabase.auth.token');
      localStorage.removeItem('sb:token');
      localStorage.removeItem('supabase.auth'); // older key names
      sessionStorage.clear();
    } catch (e) {
      console.warn('Client storage cleanup error', e);
    }

    // Attempt to call a server logout endpoint to clear HttpOnly cookies if you have one
    // (create this endpoint server-side to clear any server-side cookies)
    try {
      await fetch('/api/logout', { method: 'POST', credentials: 'include' });
    } catch (e) {
      // not fatal
    }

    // Optional: unregister service workers
    if ('serviceWorker' in navigator) {
      try {
        const regs = await navigator.serviceWorker.getRegistrations();
        for (const r of regs) await r.unregister();
      } catch (e) { console.warn('SW unregister failed', e); }
    }

    // final redirect
    window.location.replace('/index.html');
  } catch (err) {
    console.error('logout failed', err);
    window.location.replace('/index.html');
  }
}
window.logOut = logOutCompleteKeepChats;


// conservative app init
async function initAuth() {
  if (!window.supabase || !supabase.auth) return;

  // ask supabase for the session instead of trusting localStorage
  const { data: { session } = {} } = await supabase.auth.getSession?.() || { data: {} };

  if (session && session.user) {
    // OPTIONAL: validate session server-side or fetch user profile before treating as logged-in
    console.log('valid session found', session.user.email);
    // continue to load user content (and chats)
    await onUserLoggedIn(session.user);
  } else {
    console.log('no valid session found â€” keep logged-out UI');
    // intentionally do NOT auto sign-in
    showLoggedOutUI();
  }
}

initAuth();




        function createNewChat(title = 'New Conversation') {
            const chat = {
                id: uid('chat'),
                title,
                messages: [],
                createdAt: nowISO(),
                updatedAt: nowISO()
            };

            chats.unshift(chat);
            selectedChatId = chat.id;
            saveState();
            renderAll();
            closeSidebar();
        }

        function selectChat(chatId) {
            selectedChatId = chatId;
            saveState();
            renderAll();
            closeSidebar();
        }

        function deleteChat(chatId) {
            if (!confirm('Delete this conversation? This action cannot be undone.')) return;

            chats = chats.filter(chat => chat.id !== chatId);
            if (selectedChatId === chatId) {
                selectedChatId = chats[0]?.id || null;
            }
            saveState();
            renderAll();
        }

        function renameChat(chatId) {
            const chat = chats.find(c => c.id === chatId);
            if (!chat) return;

            const newTitle = prompt('Enter new chat title:', chat.title || 'Untitled');
            if (newTitle !== null && newTitle.trim()) {
                chat.title = newTitle.trim();
                chat.updatedAt = nowISO();
                saveState();
                renderAll();
            }
        }

        function exportChat(chatId) {
            const chat = chats.find(c => c.id === chatId);
            if (!chat) return;

            const exportData = {
                title: chat.title,
                messages: chat.messages,
                createdAt: chat.createdAt,
                exportedAt: nowISO()
            };

            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${(chat.title || 'chat').replace(/[^a-zA-Z0-9]/g, '_').toLowerCase()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        async function fetchAIResponse(chatMessages) {
            if (API_KEY === "AIzaSyClTZv-lqamlNZV1nJDQyLQ8pKrP43joBA" || !API_KEY) {
                await new Promise(resolve => setTimeout(resolve, 1500));
                return ``;
            }

            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${API_KEY}`;
            const contents = chatMessages.map(msg => ({
                role: msg.role === 'assistant' ? 'model' : 'user',
                parts: [{ text: msg.text }]
            }));

            const payload = {
                contents,
                systemInstruction: { parts: [{ text: SYSTEM_PROMPT }] },
                generationConfig: {
                    temperature: 0.8,
                    topK: 40,
                    topP: 0.95,
                    maxOutputTokens: 4096
                }
            };

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`API Error: ${response.status} - ${response.statusText}`);
                }

                const data = await response.json();
                const text = data?.candidates?.[0]?.content?.parts?.[0]?.text;
                if (!text) {
                    throw new Error('No response text from the API.');
                }

                return text;
            } catch (error) {
                console.error('AI API Error:', error);
                return `NETWORk ERROR `;
            }
        }

        function setLoading(loading) {
            isLoading = loading;
            elements.sendBtn.disabled = loading;
            elements.imageGenBtn.disabled = loading;
            elements.composerInput.disabled = loading;
            elements.typingStatus.classList.toggle('hidden', !loading);

            if (loading) {
                elements.sendBtn.innerHTML = `
                    â†‘
                `;
            } else {
                elements.sendBtn.innerHTML = `
                   â†‘
                `;
            }
        }

        function addMessage(role, text) {
            let chat = getSelectedChat();
            if (!chat) {
                createNewChat();
                chat = getSelectedChat();
            }

            const message = {
                id: uid('msg'),
                role,
                text,
                createdAt: nowISO()
            };

            chat.messages.push(message);
            chat.updatedAt = nowISO();

            if (chat.messages.length === 1 && role === 'user' && chat.title === 'New Conversation') {
                chat.title = truncateText(text, 40) || 'Untitled Chat';
            }

            saveState();
            renderAll();
            scrollToBottom();
        }

        function openSidebar() {
            if (window.innerWidth <= 1023) {
                elements.sidebar.classList.remove('hidden');
                elements.sidebar.classList.add('open');
                elements.sidebarOverlay.classList.add('active');
                document.body.style.overflow = 'hidden';

                const firstFocusable = elements.sidebar.querySelector('button, input');
                if (firstFocusable) {
                    setTimeout(() => firstFocusable.focus(), 100);
                }
            }
        }

        function closeSidebar() {
            if (window.innerWidth <= 1023) {
                elements.sidebar.classList.remove('open');
                elements.sidebarOverlay.classList.remove('active');
                document.body.style.overflow = 'auto';

                setTimeout(() => {
                    if (!elements.sidebar.classList.contains('open')) {
                        elements.sidebar.classList.add('hidden');
                    }
                }, 300);

                elements.composerInput?.focus();
            }
        }

        function autoResizeTextarea() {
            elements.composerInput.style.height = 'auto';
            const maxHeight = window.innerWidth <= 767 ? 80 : 120;
            const newHeight = Math.min(elements.composerInput.scrollHeight, maxHeight);
            elements.composerInput.style.height = newHeight + 'px';
        }

        function renderChatsList(filter = '') {
            const filteredChats = chats.filter(chat =>
                chat.title.toLowerCase().includes(filter.toLowerCase())
            );

            if (filteredChats.length === 0) {
                elements.chatsList.innerHTML = `
                    <div class="text-center py-6 lg:py-8 text-gray-400 px-4">
                        <svg class="w-10 h-10 lg:w-12 lg:h-12 mx-auto mb-3 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                        </svg>
                        <p class="text-sm">No conversations yet</p>
                        <p class="text-xs mt-1">Start a new chat to begin</p>
                    </div>
                `;
                return;
            }

            elements.chatsList.innerHTML = filteredChats.map(chat => {
                const lastMessage = chat.messages[chat.messages.length - 1];
                const isActive = selectedChatId === chat.id;

                return `
                    <div class="chat-item p-3 lg:p-4 cursor-pointer ${isActive ? 'active' : ''}" data-chat-id="${chat.id}">
                        <div class="flex items-start gap-2 lg:gap-3">
                            <div class="w-8 h-8 lg:w-10 lg:h-10 rounded-lg bg-gradient-to-br from-violet-500 to-purple-600 flex items-center justify-center text-white font-bold text-xs lg:text-sm shrink-0">
                                ${chat.title.slice(0, 2).toUpperCase()}
                            </div>
                            <div class="flex-1 min-w-0">
                                <h3 class="text-sm lg:text-sm font-medium text-white truncate mb-1">${escapeHtml(chat.title)}</h3>
                                <p class="text-xs text-gray-400 truncate">
                                    ${lastMessage ?
                        (lastMessage.role === 'user' ? 'You: ' : 'Neuralux ai: ') +
                        truncateText(lastMessage.text.replace(/[#*`]/g, ''), window.innerWidth <= 374 ? 25 : 35)
                        : 'No messages yet'}
                                </p>
                                <p class="text-xs text-gray-500 mt-1">${lastMessage ? formatTime(lastMessage.createdAt) : formatTime(chat.createdAt)}</p>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            elements.chatsList.querySelectorAll('.chat-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    const chatId = item.dataset.chatId;
                    selectChat(chatId);
                });

                item.addEventListener('touchstart', () => {
                    item.style.transform = 'scale(0.98)';
                });

                item.addEventListener('touchend', () => {
                    item.style.transform = '';
                });
            });
        }


        function detectLanguage(code) {
            const trimmed = code.trim();

            if (trimmed.includes('import ') && trimmed.includes('=>')) return 'javascript';
            if (trimmed.includes('def ') || trimmed.includes('print(')) return 'python';
            if (trimmed.includes('interface ') || trimmed.includes(': string')) return 'typescript';
            if (trimmed.includes('<div') || trimmed.includes('<html')) return 'html';
            if (trimmed.includes('{') && trimmed.includes('color:')) return 'css';
            if (trimmed.includes('SELECT ') || trimmed.includes('INSERT ')) return 'sql';
            if (trimmed.includes('#include') || trimmed.includes('int main')) return 'c';
            if (trimmed.includes('public class') || trimmed.includes('System.out')) return 'java';

            return 'javascript'; // default
        }

        function formatMessageContent(text) {
            if (!text) return '';

            let formatted = escapeHtml(text);

            // Headers
            formatted = formatted.replace(/^### (.*$)/gm, '<h3 class="text-base lg:text-lg font-semibold text-white mt-3 lg:mt-4 mb-2 first:mt-0">$1</h3>');
            formatted = formatted.replace(/^## (.*$)/gm, '<h2 class="text-lg lg:text-xl font-bold text-white mt-4 lg:mt-5 mb-2 lg:mb-3 first:mt-0">$1</h2>');
            formatted = formatted.replace(/^# (.*$)/gm, '<h1 class="text-xl lg:text-2xl font-bold text-white mt-5 lg:mt-6 mb-3 lg:mb-4 first:mt-0">$1</h1>');

            // Bold and italic
            formatted = formatted.replace(/\*\*(.*?)\*\*/g, '<strong class="font-semibold text-white">$1</strong>');
            formatted = formatted.replace(/(?<!\*)\*([^*\n]+)\*(?!\*)/g, '<em class="italic">$1</em>');

            // Code blocks with proper language detection and VS Code styling
            formatted = formatted.replace(/```(\w+)?\n?([\s\S]*?)```/g, (match, lang, code) => {
                const detectedLang = lang || detectLanguage(code);
                const trimmedCode = code.trim();
                return `<div class="code-container relative"><pre class="language-${detectedLang}"><code class="language-${detectedLang}">${escapeHtml(trimmedCode)}</code></pre><button class="copy-button" data-code="${escapeHtml(trimmedCode)}"><i class="fa-solid fa-copy"></i></button></div>`;
            });

            // Inline code
            formatted = formatted.replace(/`([^`\n]+)`/g, '<code>$1</code>');

            // Lists
            formatted = formatted.replace(/^- (.*$)/gm, '<li class="ml-3 lg:ml-4 mb-1 list-disc">$1</li>');
            formatted = formatted.replace(/^(\d+)\. (.*$)/gm, '<li class="ml-3 lg:ml-4 mb-1 list-decimal">$2</li>');
            formatted = formatted.replace(/(<li.*?<\/li>\s*)+/g, '<ul class="my-2 lg:my-3 space-y-1 pl-4">$&</ul>');

            return formatted;
        }

        async function generateImage(prompt) {
            try {
                const response = await fetch(
                    "https://api-inference.huggingface.co/models/black-forest-labs/FLUX.1-dev",
                    {
                        headers: {
                            Authorization: `Bearer ${HF_API_KEY}`,
                            "Content-Type": "application/json",
                        },
                        method: "POST",
                        body: JSON.stringify({
                            inputs: prompt,
                            parameters: {
                                guidance_scale: 7.5,
                                num_inference_steps: 50,
                                width: 1024,
                                height: 1024
                            }
                        }),
                    }
                );

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('API Response:', errorText);
                    throw new Error(`HTTP error! status: ${response.status} - ${errorText}`);
                }

                const blob = await response.blob();

                // Check if blob is valid
                if (blob.size === 0) {
                    throw new Error('Received empty response from image generation API');
                }

                return URL.createObjectURL(blob);
            } catch (error) {
                console.error('Image generation error:', error);
                throw error;
            }
        }

        function isImageGenerationRequest(text) {
            const imageKeywords = [
                'generate image', 'create image', 'make image', 'draw', 'generate picture',
                'create picture', 'make picture', 'generate photo', 'create photo',
                'image of', 'picture of', 'photo of', 'generate art', 'create art',
                'make art', 'artwork', 'illustration', 'sketch', 'painting',
                'visualize', 'show me a picture', 'design an image'
            ];

            const lowerText = text.toLowerCase();
            return imageKeywords.some(keyword => lowerText.includes(keyword));
        }

        function createImageLoadingPlaceholder() {
            return `
                <div class="image-loading">
                    <div class="flex items-center gap-3">
                        <div class="image-loading-spinner"></div>
                        <div class="text-sm text-gray-300">
                            <div class="font-medium">Generating image...</div>
                            <div class="text-xs text-gray-400 mt-1">This may take a few moments</div>
                        </div>
                    </div>
                </div>
            `;
        }

        function createImageDisplay(imageUrl, prompt) {
            return `
                <div class="image-container">
                    <img src="${imageUrl}" alt="Generated image: ${prompt}" 
                         class="max-w-full h-auto rounded-lg shadow-lg border border-white/10" 
                         style="max-height: min(400px, 50vh); object-fit: contain;" 
                         onload="this.style.opacity='1'" 
                         style="opacity: 0; transition: opacity 0.3s ease;">
                    <p class="text-xs text-gray-400 mt-2 italic">Generated: "${truncateText(prompt, 60)}"</p>
                </div>
            `;
        }

        function renderMessages() {
            const chat = getSelectedChat();

            if (!chat || chat.messages.length === 0) {
                elements.emptyState.style.display = 'flex';
                elements.messages.style.display = 'none';
                return;
            }

            elements.emptyState.style.display = 'none';
            elements.messages.style.display = 'block';

            elements.messages.innerHTML = chat.messages.map((message, index) => {
                const isUser = message.role === 'user';
                const isTyping = message.text === '...';

                if (isTyping) {
                    return `
                        <div class="message-container flex justify-start fade-in" style="animation-delay: ${index * 0.1}s">
                            <div class="typing-indicator">
                                <div class="typing-dot"></div>
                                <div class="typing-dot"></div>
                                <div class="typing-dot"></div>
                                <span class="text-xs lg:text-sm text-gray-400 ml-2">Neuralux ai is thinking...</span>
                            </div>
                        </div>
                    `;
                }

                return `
                    <div class="message-container flex ${isUser ? 'justify-end' : 'justify-start'} fade-in px-3 lg:px-0" style="animation-delay: ${index * 0.1}s">
                        <div class="message-bubble max-w-[95%] sm:max-w-[90%] md:max-w-[85%] lg:max-w-[75%]">
                            ${!isUser ? `
                                <div class="flex items-center gap-2 mb-2">
                                    <div class="w-5 h-5 lg:w-6 lg:h-6 rounded-full bg-gradient-to-br from-violet-500 to-purple-600 flex items-center justify-center shrink-0">
                                     <img width="48" height="48" src="https://img.icons8.com/pulsar-gradient/48/artificial-intelligence.png" alt="artificial-intelligence"/>
                                    </div>
                                    <span class="text-xs lg:text-sm font-medium text-gray-300">Neuralux ai</span>
                                </div>
                            ` : ''}
                            
                            <div class="${isUser ? 'message-user' : 'message-assistant'} rounded-xl lg:rounded-2xl px-3 lg:px-4 py-2 lg:py-3">
                                <div class="text-sm lg:text-base leading-relaxed ${isUser ? 'text-white' : 'text-gray-100'} message-content">
                                    ${formatMessageContent(message.text)}
                                </div>
                             
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            // Apply syntax highlighting and add copy functionality
            setTimeout(() => {
                if (window.Prism) {
                    Prism.highlightAll();
                }

                document.querySelectorAll('.copy-button').forEach(button => {
                    button.addEventListener('click', function () {
                        const code = this.getAttribute('data-code') ||
                            this.parentElement.querySelector('code').innerText;

                        navigator.clipboard.writeText(code).then(() => {
                            this.innerHTML = '<i class="fa-solid fa-check"></i>';
                            setTimeout(() => {
                                this.innerHTML = '<i class="fa-solid fa-copy"></i>';
                            }, 2000);
                        }).catch(() => {
                            this.innerHTML = '<i class="fa-solid fa-times"></i>';
                            setTimeout(() => {
                                this.innerHTML = '<i class="fa-solid fa-copy"></i>';
                            }, 2000);
                        });
                    });
                });
            }, 100);

            scrollToBottom();
        }

        function updateHeader() {
            const chat = getSelectedChat();

            if (!chat) {
                elements.chatTitle.textContent = 'New Conversation';
                elements.chatSubtitle.textContent = 'Start chatting with Neuralux ai';
                return;
            }

            elements.chatTitle.textContent = chat.title || 'Untitled Chat';

            const messageCount = chat.messages.length;
            const timeText = formatTime(chat.updatedAt);

            if (window.innerWidth <= 320) {
                elements.chatSubtitle.textContent = `${messageCount} msg`;
            } else if (window.innerWidth <= 480) {
                elements.chatSubtitle.textContent = `${messageCount} messages`;
            } else if (window.innerWidth <= 767) {
                elements.chatSubtitle.textContent = `${messageCount} messages â€¢ ${timeText}`;
            } else {
                elements.chatSubtitle.textContent = `${messageCount} message${messageCount !== 1 ? 's' : ''} â€¢ ${timeText}`;
            }
        }

        function renderAll() {
            renderChatsList();
            renderMessages();
            updateHeader();
        }

        // Event listeners
        elements.sidebarToggle?.addEventListener('click', (e) => {
            e.preventDefault();
            openSidebar();
        });

        elements.sidebarClose?.addEventListener('click', (e) => {
            e.preventDefault();
            closeSidebar();
        });

        elements.sidebarOverlay?.addEventListener('click', (e) => {
            e.preventDefault();
            closeSidebar();
        });

        elements.newChatBtn?.addEventListener('click', (e) => {
            e.preventDefault();
            createNewChat();
        });

        elements.chatSearch?.addEventListener('input', (e) => {
            renderChatsList(e.target.value);
        });

        elements.sendBtn?.addEventListener('click', (e) => {
            e.preventDefault();
            if (!isLoading) sendMessage();
        });

        elements.composerInput?.addEventListener('input', autoResizeTextarea);

        elements.composerInput?.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                if (!isLoading) sendMessage();
            }
        });

        elements.imageGenBtn?.addEventListener('click', (e) => {
            e.preventDefault();
            const currentText = elements.composerInput.value;
            elements.composerInput.value = currentText ? `Generate image: ${currentText}` : 'Generate image: ';
            elements.composerInput.focus();
            autoResizeTextarea();
        });

        elements.renameBtn?.addEventListener('click', (e) => {
            e.preventDefault();
            const chat = getSelectedChat();
            if (chat) renameChat(chat.id);
        });

        elements.deleteBtn?.addEventListener('click', (e) => {
            e.preventDefault();
            const chat = getSelectedChat();
            if (chat) deleteChat(chat.id);
        });

        elements.exportBtn?.addEventListener('click', (e) => {
            e.preventDefault();
            const chat = getSelectedChat();
            if (chat) exportChat(chat.id);
        });

        elements.quickExampleBtn?.addEventListener('click', async (e) => {
            e.preventDefault();
            if (!selectedChatId) createNewChat('Advanced Development Tips');
            elements.composerInput.value = "Show me how to create a modern React component with TypeScript, including proper error handling and accessibility features";
            autoResizeTextarea();
            await sendMessage();
        });

        async function sendMessage() {
            const text = elements.composerInput.value.trim();
            if (!text || isLoading) return;

            elements.composerInput.value = '';
            elements.composerInput.style.height = 'auto';

            if (window.innerWidth <= 767) {
                elements.composerInput.blur();
                setTimeout(() => elements.composerInput.focus(), 100);
            }

            addMessage('user', text);

            // Check if this is an image generation request
            if (isImageGenerationRequest(text)) {
                setLoading(true);

                // Add a message with loading state
                addMessage('assistant', 'ðŸŽ¨ I\'ll generate that image for you!\n\n' + createImageLoadingPlaceholder());

                try {
                    // Extract prompt for image generation
                    const cleanPrompt = text.replace(/^(generate|create|make|draw)\s+(image|picture|photo|art)(\s+of)?:?\s*/i, '').trim();
                    const finalPrompt = cleanPrompt || text;

                    console.log('Generating image with prompt:', finalPrompt);
                    const imageUrl = await generateImage(finalPrompt);

                    const chat = getSelectedChat();
                    if (chat) {
                        const lastMessage = chat.messages[chat.messages.length - 1];
                        if (lastMessage && lastMessage.role === 'assistant') {
                            // ---------- Typing animation helpers ----------
                            let currentTypingController = null;

                            function cancelCurrentTyping() {
                                if (currentTypingController) {
                                    currentTypingController.cancelled = true;
                                    currentTypingController = null;
                                }
                            }

                            function sleep(ms) { return new Promise(resolve => setTimeout(resolve, ms)); }

                            /**
                             * Animate assistant text into the last message, char-by-char.
                             * - chat: the chat object
                             * - lastMessage: the message object (assistant) to update
                             * - fullText: complete AI response string
                             * - options.delayPerChar: base ms per character (default 18)
                             */
                            async function animateAssistantReply(chat, lastMessage, fullText, options = {}) {
                                // cancel any previous typing animation
                                cancelCurrentTyping();
                                const controller = { cancelled: false };
                                currentTypingController = controller;

                                const delayPerChar = options.delayPerChar ?? 18; // 12-30ms feels natural; tune to taste
                                const minChunk = 1; // size of step (chars)
                                const maxChunk = options.maxChunk ?? 4; // allow small bursts for speed

                                // normalize line endings
                                fullText = String(fullText || '');

                                // start with empty text so UI shows typing progression
                                lastMessage.text = '';
                                lastMessage.createdAt = nowISO();
                                chat.updatedAt = nowISO();
                                saveState();
                                renderMessages();
                                scrollToBottom();

                                // We'll reveal char-by-char but allow small variable delays after punctuation
                                const punctuationPause = (ch) => {
                                    if (/[.,;:!?]/.test(ch)) return delayPerChar * 6; // longer pause after punctuation
                                    if (ch === '\n') return delayPerChar * 8; // newlines = slight pause
                                    return delayPerChar;
                                };

                                let i = 0;
                                const n = fullText.length;

                                while (i < n) {
                                    if (controller.cancelled) break;

                                    // choose chunk size: sometimes 1..maxChunk chars to avoid too many renders
                                    let chunkSize = minChunk;
                                    // simple heuristic: when next chars are letters keep chunk small, otherwise allow bigger chunks
                                    if (i + 1 < n && /\S/.test(fullText[i + 1])) chunkSize = Math.min(maxChunk, Math.ceil(Math.random() * maxChunk));
                                    const nextI = Math.min(n, i + chunkSize);

                                    lastMessage.text = fullText.slice(0, nextI);
                                    lastMessage.createdAt = nowISO();
                                    chat.updatedAt = nowISO();
                                    saveState();       // persist progress so refresh keeps partial text (optional)
                                    renderMessages();  // re-render messages
                                    scrollToBottom();

                                    // compute delay using the last char we just revealed
                                    const lastChar = fullText[nextI - 1] || '';
                                    const wait = punctuationPause(lastChar);

                                    await sleep(wait);
                                    i = nextI;
                                }

                                // finished (if not cancelled) â€” ensure final full text & final save
                                if (!controller.cancelled) {
                                    lastMessage.text = fullText;
                                    lastMessage.createdAt = nowISO();
                                    chat.updatedAt = nowISO();
                                    saveState();
                                    renderMessages();
                                    scrollToBottom();
                                }

                                // clear controller
                                if (currentTypingController === controller) currentTypingController = null;
                            }

                            // ---------- Integrate into sendMessage() ----------
                            // Replace the block where you currently set lastMessage.text = aiResponse; ... with this:

                            /* example replacement inside your try block after receiving aiResponse */
                            if (chat) {
                                const lastMessage = chat.messages[chat.messages.length - 1];
                                if (lastMessage && lastMessage.role === 'assistant' && lastMessage.text === '...') {
                                    // Use animateAssistantReply instead of assigning all at once
                                    await animateAssistantReply(chat, lastMessage, aiResponse, { delayPerChar: 16, maxChunk: 3 });
                                }
                            }

                        }
                    }
                } catch (error) {
                    console.error('Image generation failed:', error);
                    const chat = getSelectedChat();
                    if (chat) {
                        const lastMessage = chat.messages[chat.messages.length - 1];
                        if (lastMessage && lastMessage.role === 'assistant') {
                            lastMessage.text = `## âš ï¸ Image Generation Error

I encountered an issue while generating your image. This could be due to:

- **API rate limits** or **server overload**
- **Content policy restrictions**  
- **Network connectivity issues**
- **Model temporarily unavailable**

Please try again with a different prompt or wait a moment before retrying. You can also try simplifying your prompt for better results.

**Tip**: Try prompts like "a beautiful sunset over mountains" or "a futuristic city skyline"`;
                            lastMessage.createdAt = nowISO();
                            chat.updatedAt = nowISO();
                            saveState();
                            renderMessages();
                            scrollToBottom();
                        }
                    }
                } finally {
                    setLoading(false);
                }
                return;
            }

            // Regular text message handling
            setLoading(true);
            addMessage('assistant', '...');

            try {
                const chat = getSelectedChat();
                const aiResponse = await fetchAIResponse(chat.messages);

                if (chat) {
                    const lastMessage = chat.messages[chat.messages.length - 1];
                    if (lastMessage && lastMessage.role === 'assistant' && lastMessage.text === '...') {
                        lastMessage.text = aiResponse;
                        lastMessage.createdAt = nowISO();
                        chat.updatedAt = nowISO();
                        saveState();
                        renderMessages();
                        scrollToBottom();
                    }
                }
            } catch (error) {
                console.error('Error sending message:', error);
                const chat = getSelectedChat();
                if (chat) {
                    const lastMessage = chat.messages[chat.messages.length - 1];
                    if (lastMessage && lastMessage.role === 'assistant' && lastMessage.text === '...') {
                        lastMessage.text = '## âš ï¸ Error\n\nSorry, I encountered an error processing your request. Please try again.';
                        lastMessage.createdAt = nowISO();
                        chat.updatedAt = nowISO();
                        saveState();
                        renderMessages();
                        scrollToBottom();
                    }
                }
            } finally {
                setLoading(false);
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeSidebar();
            }

            if ((e.metaKey || e.ctrlKey) && e.key === 'n') {
                e.preventDefault();
                createNewChat();
            }
        });

        // Responsive design handlers
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                if (window.innerWidth > 1023) {
                    elements.sidebar.classList.remove('hidden', 'open');
                    elements.sidebarOverlay.classList.remove('active');
                    document.body.style.overflow = 'auto';
                }

                updateHeader();
                autoResizeTextarea();
            }, 100);
        });

        window.addEventListener('orientationchange', () => {
            setTimeout(() => {
                updateHeader();
                scrollToBottom();
                autoResizeTextarea();
            }, 300);
        });

        // Touch gesture support for mobile
        let touchStartX = 0;
        let touchStartY = 0;

        document.addEventListener('touchstart', (e) => {
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
        }, { passive: true });

        document.addEventListener('touchmove', (e) => {
            if (!elements.sidebar.classList.contains('open')) return;

            const touchX = e.touches[0].clientX;
            const touchY = e.touches[0].clientY;
            const deltaX = touchX - touchStartX;
            const deltaY = Math.abs(touchY - touchStartY);

            if (deltaX < -50 && deltaY < 100 && window.innerWidth <= 1023) {
                closeSidebar();
            }
        }, { passive: true });

        function initializeApp() {
            loadState();

            if (chats.length === 0) {
                createNewChat('Welcome to Neuralux ai');
                addMessage('assistant', `# ðŸ‘‹ Welcome to Neuralux ai!
`);
                saveState();
            }

            if (!selectedChatId && chats.length > 0) {
                selectedChatId = chats[0].id;
            }

            renderAll();

            setTimeout(() => {
                if (window.innerWidth > 767) {
                    elements.composerInput?.focus();
                }
            }, 500);

            // iOS optimization
            if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
                document.addEventListener('touchstart', () => { }, { passive: true });
            }
        }

        initializeApp();
    </script>
</body>

</html>